■Splunk trainng

★IFX
　フィールド抽出の正規表現を共有したり、自動で正規表現を作成することができる。

★Tag
host=www1とhost=www2のへdmzを設定し、host=dmzのように検索することが可能になる。
イベントタブの＞を押下して、アクションでタグ編集可能

★Event Type
同一の意味を持つログでもシステム毎に違っているので、一纏めにしてグループ化する。

イベントタイプとレポートどっちがいいか？
⇒検索の文字列を分類したい場合
⇒カテゴリを生成したい場合
⇒タイプの集計をしたい場合

eventtype=
上記コマンドで検索できる。


★ワークフローアクション
外部との連携がとれる。
　・get
　・search
　・post
 
　⇒get URLを設定して外部サイト連携できる。
 　（例）ipアドレスが不正かどうか外部サイトで確認ができる。
 
　⇒post get同じ
　　ヘッダーに情報を入れるか、セッションに入れて外部連携するかどうかの違い。
  
　⇒search
　　検索の文字列を入力する。
　　追加検索が行える感じ
  
　フィールドの変数は、$を使う　エスケープとしては、!をつける。$!のように。
 
 
★アラート
　⇒スケジュールアラート
　⇒リアルタイムアラート
 
 トリガーの条件
　・マッチするイベントがあれば（でふぉ）
　・件数より大きい
　・カスタムで検索式を記載して条件を設定できる
 
 アクティビティのアラートで実行されたアラートを確認できる。
 
 
★マクロ
　サーチ分を別名として定義できる。
　実行時は、バッククォートで囲ってあげると実行できるコマンドとなる。
　引数も渡すことが可能


★データモデル
　・イベント
　　⇒検索分を作成し、親子の関係を作成する。
　・サーチ
　　⇒マクロに似ている
　・トランザクション
　　⇒イベントかサーチができる状態作成する。
　　⇒バック処理でトランザクションコマンドが使われる。
  
データモデルを作成すると、高速化できる
※イベントだけ


Splunk Common infomation Model
正規化するデータモデルを提供してくれるapps
データモデルの共有もできる

プライベートだと高速化できない
しかし高速化してサマリ範囲を広げるとデータ容量をたくさん使用することになる。



12/1
◎Admin Traning

デート取り込み⇒データの加工⇒ディスクに書き込み⇒データの抽出
input⇒parsing⇒indexing⇒searching

サーチするのは、search heads
ディスク書き込み、データの加工、indexars
データ取り込み、fowarder


■Fowardar
データを集めて、indexersへデータを転送する。
univarsal Fowarder,heavy Fowarderの2種類がある。

■Indexer
データを取得し、加工して、ディスクに書き込む。
IOPSにIndexersに影響がある。。。


■Search head
1検索あたり、1コア使用する。
ユーザ多ければ、コアを増やすか、サーチヘッドを増やす。


NTPサーバの設定が必要。

プロセスについて
ディスクにアクセスるものがsplunkd 8089

Splunk Web 8000


★ライセンスについて
・Enterpriseトライアルライセンス
　⇒1日500MBまで
　⇒60日間限定のライセンスその後フリーライセンス
 
・フリーライセンス
　⇒1日500MBまで
　⇒クラスタ×、分散構成×、その他もろもろできない。
  
・Fowarderライセンス
　⇒Splunkサーバへ転送する。
　⇒書き込みはできない。
 
  /etc/licenses

・Enterpriseライセンス
　⇒制限なし
　
　ライセンスのプールが行える。
　ライセンスマスターサーバ分のライセンスがあればOK
　プールはデータを取り込む量を、分けることができる。
 500MBのライセンスなら、200MBと300MBみたいなかんじで。
 
★input.conf
データをGUIから追加する場合は、appsフォルダは以下のurlのフォルダのinput.confが編集される。


addonと呼ばれるAppは、Fowarderに関するもの。
　
 
sp_home/etc/...下に.confを配置する。

defaultとlocaのファイル
web上から変更する場合は、locaのディレクトリが更新される。
設定を変更（オーバライド）する場合は、defaultでディレクトリではなく、
localのディレクトリに設定がされる。こちらで設定する。

グローバル設定だとsystemフォルダから設定がされる。



12/2
★Forwarder
forwarderでは、splunktcp port転送します。
データのバーファーができます。
LBの機能もあります。
forwarder managementで集中管理できます。

★heavy forwarder
indexerへデータを連携する場合にルーティングを設定できる。
中間Fowarderとしての役目がある。
このデータは、このindexerみたいなデータを条件に設定できる。


indexerのinput.conf(recevingの設定をする)
↑
fwのoutput.conf,input.confを設定する。


圧縮転送する場合は、
compressed = trueを追加設定する。
input.conf(indexer側)
output.conf(fowarder側)
CPUに影響が多少はある。

SSLで転送する場合は。
圧縮時と同じファイルをなおす。


★indexer Acknowledgement
inderxerの取り込み確認ができるまで、
データを保持できる。


fowarderの配信
複数サーバがある場合いちいちやってられないので、
そのやり方。

サーバクラスを定義できる。

inputs.confを編集することで、
取り込むログのフィールドをある程度設定できる。


